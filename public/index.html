<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wandermap AI</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        #root { height: 100vh; width: 100vw; }
        #map-container { height: 100%; width: 100%; z-index: 0; }
        .leaflet-pane { z-index: 0 !important; }
        .nav-panel { z-index: 1000; }
        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        .thinking-dot {
            animation: bounce 1.4s infinite ease-in-out;
        }
        .thinking-dot:nth-child(1) { animation-delay: 0s; }
        .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
        .thinking-dot:nth-child(3) { animation-delay: 0.4s; }
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SVG Icon Components ---
        const Icons = {
            Navigation: ({ className = "", size = 20 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polygon points="3 11 22 2 13 21 11 13 3 11"/>
                </svg>
            ),
            Send: ({ className = "", size = 16 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
                </svg>
            ),
            Sparkles: ({ className = "", size = 20 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                    <path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>
                </svg>
            ),
            Trash2: ({ className = "", size = 18 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
            ),
            MapPin: ({ className = "", size = 18 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>
                </svg>
            ),
            Clock: ({ className = "", size = 18 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                </svg>
            ),
            Route: ({ className = "", size = 20 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="6" cy="19" r="3"/><path d="M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15"/><circle cx="18" cy="5" r="3"/>
                </svg>
            ),
            PanelLeftClose: ({ className = "", size = 18 }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><path d="M9 3v18"/><path d="m16 15-3-3 3-3"/>
                </svg>
            )
        };

        // --- Thinking Indicator Component ---
        const ThinkingIndicator = () => (
            <div className="flex justify-start">
                <div className="max-w-[85%] p-3 rounded-2xl text-sm leading-relaxed shadow-sm bg-gray-100 text-gray-800 rounded-tl-none">
                    <div className="flex items-center gap-1">
                        <span className="thinking-dot w-2 h-2 bg-gray-400 rounded-full inline-block"></span>
                        <span className="thinking-dot w-2 h-2 bg-gray-400 rounded-full inline-block"></span>
                        <span className="thinking-dot w-2 h-2 bg-gray-400 rounded-full inline-block"></span>
                    </div>
                </div>
            </div>
        );

        // --- Autocomplete Input Component ---
        const AutocompleteInput = ({ value, onChange, onSelect, placeholder, icon, suggestions, isLoading }) => {
            const [showDropdown, setShowDropdown] = useState(false);
            const inputRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (e) => {
                    if (inputRef.current && !inputRef.current.contains(e.target)) {
                        setShowDropdown(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            return (
                <div className="relative" ref={inputRef}>
                    <div className="flex items-center gap-2 bg-gray-100 p-2 rounded-md border border-transparent focus-within:border-orange-500 focus-within:bg-white transition-colors">
                        {icon}
                        <input 
                            className="bg-transparent w-full outline-none text-sm text-gray-700 placeholder-gray-400"
                            placeholder={placeholder}
                            value={value}
                            onChange={(e) => {
                                onChange(e.target.value);
                                setShowDropdown(true);
                            }}
                            onFocus={() => setShowDropdown(true)}
                        />
                        {isLoading && (
                            <div className="w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
                        )}
                    </div>
                    
                    {showDropdown && suggestions.length > 0 && (
                        <div className="autocomplete-dropdown">
                            {suggestions.map((suggestion, idx) => (
                                <div
                                    key={idx}
                                    className="px-3 py-2 hover:bg-orange-50 cursor-pointer text-sm text-gray-700 border-b border-gray-100 last:border-b-0"
                                    onClick={() => {
                                        onSelect(suggestion);
                                        setShowDropdown(false);
                                    }}
                                >
                                    <div className="font-medium truncate">{suggestion.display_name.split(',')[0]}</div>
                                    <div className="text-xs text-gray-400 truncate">{suggestion.display_name}</div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- Nav Panel Component (now receives start/end as props) ---
        const NavPanel = ({ start, end, onStartChange, onEndChange, onRouteRequest, isRouteLoading }) => {
            const [mode, setMode] = useState("Driving");
            const [isOpen, setIsOpen] = useState(true);
            const [startSuggestions, setStartSuggestions] = useState([]);
            const [endSuggestions, setEndSuggestions] = useState([]);
            const [loadingStart, setLoadingStart] = useState(false);
            const [loadingEnd, setLoadingEnd] = useState(false);
            const debounceRef = useRef(null);

            const fetchSuggestions = async (query, field) => {
                if (!query || query.length < 3) {
                    if (field === 'start') setStartSuggestions([]);
                    else setEndSuggestions([]);
                    return;
                }

                if (field === 'start') setLoadingStart(true);
                else setLoadingEnd(true);

                try {
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5`,
                        { headers: { 'User-Agent': 'Wandermap/1.0' } }
                    );
                    const data = await response.json();
                    const suggestions = data.map(item => ({
                        display_name: item.display_name,
                        lat: parseFloat(item.lat),
                        lng: parseFloat(item.lon)
                    }));

                    if (field === 'start') setStartSuggestions(suggestions);
                    else setEndSuggestions(suggestions);
                } catch (error) {
                    console.error('Autocomplete error:', error);
                } finally {
                    if (field === 'start') setLoadingStart(false);
                    else setLoadingEnd(false);
                }
            };

            const handleStartChange = (value) => {
                onStartChange(value);
                clearTimeout(debounceRef.current);
                debounceRef.current = setTimeout(() => fetchSuggestions(value, 'start'), 300);
            };

            const handleEndChange = (value) => {
                onEndChange(value);
                clearTimeout(debounceRef.current);
                debounceRef.current = setTimeout(() => fetchSuggestions(value, 'end'), 300);
            };

            const handleFindRoute = () => {
                if (!start || !end || isRouteLoading) return;
                onRouteRequest(start, end, mode);
            };

            if (!isOpen) {
                return (
                    <button 
                        onClick={() => setIsOpen(true)}
                        className="absolute top-4 left-16 bg-orange-500 rounded-lg shadow-xl nav-panel p-3 hover:bg-orange-600 transition-colors"
                        title="Open navigation panel"
                    >
                        <Icons.Route className="text-white" />
                    </button>
                );
            }

            return (
                <div className="absolute top-4 left-16 w-80 bg-white rounded-lg shadow-xl nav-panel p-4 flex flex-col gap-3 font-sans">
                    <div className="flex items-center justify-between mb-1">
                        <div className="flex items-center gap-2">
                            <button
                                onClick={() => setIsOpen(false)}
                                className="p-1.5 bg-orange-500 hover:bg-orange-600 text-white rounded-md transition-colors"
                                title="Close panel"
                            >
                                <Icons.PanelLeftClose />
                            </button>
                            <div className="text-orange-500 font-bold text-lg">Wandermap</div>
                        </div>
                    </div>
                    
                    <div className="space-y-2">
                        <AutocompleteInput
                            value={start}
                            onChange={handleStartChange}
                            onSelect={(s) => onStartChange(s.display_name)}
                            placeholder="Start location"
                            icon={<div className="w-4 h-4 rounded-full border-2 border-gray-400 flex-shrink-0"></div>}
                            suggestions={startSuggestions}
                            isLoading={loadingStart}
                        />
                        <AutocompleteInput
                            value={end}
                            onChange={handleEndChange}
                            onSelect={(s) => onEndChange(s.display_name)}
                            placeholder="Destination"
                            icon={<div className="w-4 h-4 rounded-full border-2 border-orange-500 flex-shrink-0"></div>}
                            suggestions={endSuggestions}
                            isLoading={loadingEnd}
                        />
                    </div>

                    <div className="flex justify-between bg-gray-50 p-1 rounded-lg">
                        {['Driving', 'Walking', 'Biking'].map((m) => (
                            <button 
                                key={m}
                                type="button"
                                onClick={() => setMode(m)}
                                className={`px-4 py-1.5 text-xs font-medium rounded-md transition-all ${
                                    mode === m 
                                    ? 'bg-orange-500 text-white shadow-sm' 
                                    : 'text-gray-500 hover:bg-gray-200'
                                }`}
                            >
                                {m}
                            </button>
                        ))}
                    </div>

                    <button
                        type="button"
                        onClick={handleFindRoute}
                        disabled={!start || !end || isRouteLoading}
                        className={`w-full bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 rounded-lg transition-colors flex items-center justify-center gap-2 ${(!start || !end || isRouteLoading) ? 'opacity-50 cursor-not-allowed' : ''}`}
                    >
                        {isRouteLoading ? (
                            <>
                                <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                Finding Route...
                            </>
                        ) : (
                            <>
                                <Icons.Navigation />
                                Find Route
                            </>
                        )}
                    </button>
                </div>
            );
        };

        // --- Route Info Panel ---
        const RouteInfoPanel = ({ distance, duration }) => {
            if (!distance || !duration) return null;
            
            return (
                <div className="absolute bottom-8 left-16 bg-white rounded-lg shadow-xl p-4 nav-panel">
                    <div className="flex gap-6">
                        <div className="flex items-center gap-2">
                            <Icons.MapPin className="text-orange-500" />
                            <div>
                                <div className="text-xs text-gray-500">Distance</div>
                                <div className="font-semibold text-gray-800">{distance}</div>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <Icons.Clock className="text-orange-500" />
                            <div>
                                <div className="text-xs text-gray-500">Duration</div>
                                <div className="font-semibold text-gray-800">{duration}</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Map Component ---
        const MapView = ({ mapData, start, end, onStartChange, onEndChange, onRouteRequest, isRouteLoading }) => {
            const mapRef = useRef(null);
            const leafletMap = useRef(null);
            const routeLayer = useRef(null);
            const markersLayer = useRef(null);

            useEffect(() => {
                if (!leafletMap.current && mapRef.current) {
                    leafletMap.current = L.map(mapRef.current).setView([37.7749, -122.4194], 13);
                    
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                        attribution: '&copy; OpenStreetMap &copy; CARTO',
                        subdomains: 'abcd',
                        maxZoom: 20
                    }).addTo(leafletMap.current);

                    routeLayer.current = L.layerGroup().addTo(leafletMap.current);
                    markersLayer.current = L.layerGroup().addTo(leafletMap.current);

                    setTimeout(() => leafletMap.current.invalidateSize(), 200);
                }

                const handleResize = () => {
                    if (leafletMap.current) leafletMap.current.invalidateSize();
                };
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            useEffect(() => {
                if (mapData && leafletMap.current) {
                    routeLayer.current.clearLayers();
                    markersLayer.current.clearLayers();

                    const { center, zoom, route, markers } = mapData;

                    leafletMap.current.invalidateSize();

                    if (route && route.length > 0) {
                        const polyline = L.polyline(route, { 
                            color: '#f97316', 
                            weight: 5, 
                            opacity: 0.8 
                        }).addTo(routeLayer.current);
                        
                        leafletMap.current.fitBounds(polyline.getBounds(), { 
                            padding: [80, 80],
                            maxZoom: 15
                        });
                    } else if (center) {
                        leafletMap.current.flyTo(center, zoom || 13, { duration: 1.5 });
                    }

                    if (markers) {
                        markers.forEach((m, idx) => {
                            const icon = L.divIcon({
                                className: 'custom-marker',
                                html: `<div style="
                                    background: ${idx === 0 ? '#22c55e' : '#f97316'};
                                    width: 24px;
                                    height: 24px;
                                    border-radius: 50%;
                                    border: 3px solid white;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                                "></div>`,
                                iconSize: [24, 24],
                                iconAnchor: [12, 12]
                            });
                            
                            L.marker([m.lat, m.lng], { icon })
                                .bindPopup(m.label)
                                .addTo(markersLayer.current);
                        });
                    }
                }
            }, [mapData]);

            return (
                <div className="h-full w-full relative">
                    <NavPanel 
                        start={start}
                        end={end}
                        onStartChange={onStartChange}
                        onEndChange={onEndChange}
                        onRouteRequest={onRouteRequest}
                        isRouteLoading={isRouteLoading}
                    />
                    <div id="map-container" ref={mapRef} className="h-full w-full bg-gray-100" />
                    <RouteInfoPanel distance={mapData?.distance} duration={mapData?.duration} />
                </div>
            );
        };

        // --- Chat Component ---
        const ChatInterface = ({ messages, onSendMessage, onClearHistory, isConnecting, isThinking }) => {
            const [input, setInput] = useState("");
            const scrollRef = useRef(null);

            useEffect(() => {
                if(scrollRef.current) {
                    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
                }
            }, [messages, isThinking]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!input.trim() || isThinking) return;
                onSendMessage(input);
                setInput("");
            };

            return (
                <div className="flex flex-col h-full bg-white shadow-xl border-l border-gray-200">
                    <div className="p-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between">
                        <div className="flex items-center gap-2">
                            <div className="bg-orange-500 p-2 rounded-lg text-white">
                               <Icons.Sparkles />
                            </div>
                            <div>
                                <h1 className="font-bold text-gray-800">Wander Assistant</h1>
                                <p className="text-xs text-gray-500 flex items-center gap-1">
                                    <span className={`w-2 h-2 rounded-full ${isConnecting ? 'bg-yellow-400' : 'bg-green-500'}`}></span>
                                    {isConnecting ? 'Connecting...' : 'Online'}
                                </p>
                            </div>
                        </div>
                        <button 
                            onClick={onClearHistory}
                            className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                            title="Clear conversation"
                        >
                            <Icons.Trash2 />
                        </button>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 space-y-4" ref={scrollRef}>
                        {messages.length === 0 && !isThinking && (
                            <div className="text-center text-gray-400 mt-10 text-sm">
                                <p>Ask for a route by vibe...</p>
                                <p className="italic">"Take me from San Francisco to Los Angeles"</p>
                            </div>
                        )}
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] p-3 rounded-2xl text-sm leading-relaxed shadow-sm ${
                                    msg.role === 'user' 
                                    ? 'bg-orange-500 text-white rounded-tr-none' 
                                    : 'bg-gray-100 text-gray-800 rounded-tl-none'
                                }`}>
                                    {msg.content}
                                </div>
                            </div>
                        ))}
                        {isThinking && <ThinkingIndicator />}
                    </div>

                    <div className="p-4 border-t border-gray-100">
                        <form onSubmit={handleSubmit} className="relative">
                            <input 
                                type="text" 
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                placeholder={isThinking ? "Thinking..." : "Ask for directions or chat..."}
                                disabled={isThinking}
                                className={`w-full pl-4 pr-12 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:bg-white transition-all ${isThinking ? 'opacity-50 cursor-not-allowed' : ''}`}
                            />
                            <button 
                                type="submit"
                                disabled={isThinking}
                                className={`absolute right-2 top-2 p-1.5 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors ${isThinking ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                <Icons.Send />
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [messages, setMessages] = useState([]);
            const [mapData, setMapData] = useState(null);
            const [socket, setSocket] = useState(null);
            const [isConnecting, setIsConnecting] = useState(true);
            const [isThinking, setIsThinking] = useState(false);
            const [isRouteLoading, setIsRouteLoading] = useState(false);
            
            // Lifted state for navigation panel
            const [navStart, setNavStart] = useState("");
            const [navEnd, setNavEnd] = useState("");

            useEffect(() => {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/api/chat`;
                const ws = new WebSocket(wsUrl);

                ws.onopen = () => setIsConnecting(false);
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        if (data.type === 'history') {
                            setMessages(data.messages || []);
                        } else if (data.type === 'agent_response') {
                            setIsThinking(false);
                            setMessages(prev => [...prev, { role: 'assistant', content: data.text }]);
                            if (data.mapData) {
                                setMapData(data.mapData);
                                // Update navigation panel with locations from chat
                                if (data.locations) {
                                    if (data.locations.start) setNavStart(data.locations.start);
                                    if (data.locations.end) setNavEnd(data.locations.end);
                                }
                            }
                        } else if (data.type === 'map_update') {
                            setIsRouteLoading(false);
                            if (data.mapData) {
                                setMapData(data.mapData);
                            }
                        } else if (data.type === 'route_loading') {
                            setIsRouteLoading(data.loading);
                        } else if (data.type === 'error') {
                            setIsThinking(false);
                            setIsRouteLoading(false);
                            alert(data.message || 'An error occurred');
                        }
                    } catch (e) {
                        console.error('Error parsing message:', e);
                    }
                };

                ws.onclose = () => {
                    setIsConnecting(true);
                    setIsThinking(false);
                    setIsRouteLoading(false);
                };

                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };

                setSocket(ws);

                return () => ws.close();
            }, []);

            const sendChatMessage = (text) => {
                setMessages(prev => [...prev, { role: 'user', content: text }]);
                setIsThinking(true);
                
                if (socket && socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify({ type: 'chat', text }));
                }
            };

            const sendRouteRequest = (start, end, mode) => {
                setIsRouteLoading(true);
                // Update the nav panel state when route is requested from panel
                setNavStart(start);
                setNavEnd(end);
                if (socket && socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify({ type: 'route_request', start, end, mode }));
                }
            };

            const clearHistory = () => {
                if (socket && socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify({ type: 'clear_history' }));
                    setMessages([]);
                    setMapData(null);
                    setIsThinking(false);
                    setNavStart("");
                    setNavEnd("");
                }
            };

            return (
                <div className="flex h-screen w-screen overflow-hidden font-sans">
                    <div className="hidden md:block md:w-3/4 h-full relative">
                        <MapView 
                            mapData={mapData}
                            start={navStart}
                            end={navEnd}
                            onStartChange={setNavStart}
                            onEndChange={setNavEnd}
                            onRouteRequest={sendRouteRequest}
                            isRouteLoading={isRouteLoading}
                        />
                    </div>

                    <div className="w-full md:w-1/4 h-full z-10 relative">
                        <ChatInterface 
                            messages={messages} 
                            onSendMessage={sendChatMessage}
                            onClearHistory={clearHistory}
                            isConnecting={isConnecting}
                            isThinking={isThinking}
                        />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>